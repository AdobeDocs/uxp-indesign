"use strict";(self.webpackChunkuxp_indesign=self.webpackChunkuxp_indesign||[]).push([[7688],{87858:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return l},default:function(){return x}});var a=t(87462),s=t(45987),i=(t(15007),t(64983)),r=t(91515);const o=["components"],l={},d=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.mdx)("div",n)},m=d("InlineAlert"),p=d("CodeBlock"),c={_frontmatter:l},u=r.Z;function x(e){let{components:n}=e,t=(0,s.Z)(e,o);return(0,i.mdx)(u,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"file-operations"},"File operations"),(0,i.mdx)("p",null,"To perform any file operations including read, write, create, and delete, UXP provides a couple of options. But before we look at the APIs, let's get acquainted with a few concepts."),(0,i.mdx)("h2",{id:"system-requirements"},"System requirements"),(0,i.mdx)("p",null,"Please make sure your local environment uses the following application versions before proceeding."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"InDesign v18.5 or higher"),(0,i.mdx)("li",{parentName:"ul"},"UDT v1.9.0 or higher"),(0,i.mdx)("li",{parentName:"ul"},"Manifest version v5 or higher")),(0,i.mdx)("h2",{id:"concepts"},"Concepts"),(0,i.mdx)("h3",{id:"sandbox-and-other-locations"},"Sandbox and other locations"),(0,i.mdx)("p",null,"UXP, by default, only allows access to certain locations in the user's file system. These locations are referred to as the sandbox. "),(0,i.mdx)(m,{variant:"info",slots:"header, text1, text2",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"Plugins and Scripts"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"In plugins"),", a sandbox is typically the plugin's folder, plus a temporary and data folder. The plugin's location is read-only. Whereas, the temporary and data folders are provided to you to store transitory information. Note that the data stored in these locations can get accidentally erased and should not be considered permanent."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"In scripts"),", a sandbox just consists of a temporary folder. It is meant to store transitory information and can get accidentally erased."),(0,i.mdx)("p",null,"However, we understand that there are circumstances when you would like to access other file locations as well. Accessing such locations is possible in UXP but you will need to seek permission first."),(0,i.mdx)("h3",{id:"manifest-permission"},"Manifest permission"),(0,i.mdx)("p",null,"For file system access you require permission for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"localFileSystem")," module."),(0,i.mdx)(m,{variant:"info",slots:"header, text1, text2",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"Plugins and Scripts"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"In plugins"),", you should seek permission for ",(0,i.mdx)("inlineCode",{parentName:"p"},"localFileSystem")," in your manifest.",(0,i.mdx)("br",null)," IMPORTANT: Please read about the ",(0,i.mdx)("a",{parentName:"p",href:"../../../plugins/concepts/manifest/#permissionsdefinition"},"manifest permissions")," module before proceeding."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"In scripts"),", the permission for ",(0,i.mdx)("inlineCode",{parentName:"p"},"localFileSystem")," is fixed. You can ignore the manifest details in the following examples. Learn about these values in the ",(0,i.mdx)("a",{parentName:"p",href:"../../fundamentals/manifest/"},"manifest fundamentals section"),". "),(0,i.mdx)("p",null,"Let's understand the manifest settings a bit more in detail."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'/* manifest.json */\n{  \n    "requiredPermissions": {\n        "localFileSystem": "plugin"\n    }\n}\n')),(0,i.mdx)("p",null,"Allowed values for ",(0,i.mdx)("inlineCode",{parentName:"p"},"localFileSystem")," are:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"plugin"),": Default value. Provides access to the sandbox."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"request"),": Let's you request the user to select a location of their choice."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"fullAccess"),": Provides full access to the user file system")),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"Protip"),": Make sure you pick the most accurate permission for your use case because in the future we may ask users to provide their consent based on it. You may find 'fullAccess' to be the least restrictive and hence the safest to pick, but a user may not be comfortable giving full access to their system unless it's absolutely necessary and might deny the installation of your plugin. "),(0,i.mdx)("h3",{id:"schemes"},"Schemes"),(0,i.mdx)("p",null,"UXP provides a shorthand representation of these locations via schemes."),(0,i.mdx)("p",null,"For sandbox, you can use ",(0,i.mdx)("inlineCode",{parentName:"p"},"plugin:/"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"plugin-data:/"),"and ",(0,i.mdx)("inlineCode",{parentName:"p"},"plugin-temp:/"),".\nAnd, for other locations, use ",(0,i.mdx)("inlineCode",{parentName:"p"},"file:/"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-html"},'<img src="plugin:/sample.png" />\n<img src="file:/Users/user/Downloads/sample.png" /> \x3c!-- update the path based on your system --\x3e\n')),(0,i.mdx)(m,{variant:"info",slots:"header, text1, text2",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"Plugins and Scripts"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"In plugins"),", you should seek permission for ",(0,i.mdx)("inlineCode",{parentName:"p"},"localFileSystem")," in your manifest.",(0,i.mdx)("br",null)," IMPORTANT: Please read about the ",(0,i.mdx)("a",{parentName:"p",href:"../../../plugins/concepts/manifest/#permissionsdefinition"},"manifest permissions")," module before proceeding."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"In scripts"),", you can avail only ",(0,i.mdx)("inlineCode",{parentName:"p"},"plugin-temp:/")," to read/write from/to a temporary folder. "),(0,i.mdx)("h2",{id:"example"},"Example"),(0,i.mdx)("p",null,"You have two options to access the file system - ",(0,i.mdx)("inlineCode",{parentName:"p"},"LocalFileSytem")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"FS")," module. These modules are very similar in terms of the capabilities they offer, however, there is a difference in the way they carry out the task."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"LocalFileSytem")," APIs work with an object reference called ",(0,i.mdx)("inlineCode",{parentName:"p"},"Entry"),". Having an object reference makes it easier to manage and perform multiple operations. Whereas the ",(0,i.mdx)("inlineCode",{parentName:"p"},"FS")," APIs are very similar to NodeJS path-based file system APIs which make them ideal for carrying out single operations. "),(0,i.mdx)("h3",{id:"localfilesytem-api"},"LocalFileSytem API"),(0,i.mdx)("p",null,"Available via ",(0,i.mdx)("inlineCode",{parentName:"p"},"require('uxp').storage.localFileSystem")," which returns an instance of ",(0,i.mdx)("inlineCode",{parentName:"p"},"FileSystemProvider"),"."),(0,i.mdx)("h4",{id:"nomenclature"},"Nomenclature"),(0,i.mdx)("p",null,"A file system is a conglomerate of files and folders. You can use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"File")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"Folder")," classes to refer to them. However, these classes have a base class called ",(0,i.mdx)("inlineCode",{parentName:"p"},"Entry"),". The nomenclature of some of the APIs uses 'entry' in them typically when the output type can be either of the two - ",(0,i.mdx)("inlineCode",{parentName:"p"},"File")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"Folder")," and be determined only at runtime. Therefore, it's a good practice to check using ",(0,i.mdx)("inlineCode",{parentName:"p"},"isfile")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"isFolder")," before using specific APIs."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},'const { localFileSystem, types } = require(\'uxp\').storage;\nasync function foo(){\n    // Create new folder and file\n    try {\n        const newFolderEntry = await localFileSystem.createEntryWithUrl("plugin-temp:/temp", { type: types.folder });\n        if (newFolderEntry.isFolder) {\n            const newFile = await newFolderEntry.createFile("temp.txt", {overwrite: true});\n            await newFile.write("Sample file created.");\n        }\n    } catch (e) {\n        console.error(e);\n    }\n}\n')),(0,i.mdx)("p",null,"Now let's take a look at some examples to access system locations based on permission settings."),(0,i.mdx)("h4",{id:"accessing-sandbox"},"Accessing sandbox"),(0,i.mdx)(p,{slots:"heading, code",repeat:"2",languages:"JSON, JavaScript",mdxType:"CodeBlock"}),(0,i.mdx)("h4",{id:"javascript"},"JavaScript"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"const fsProvider = require('uxp').storage.localFileSystem;\nasync function foo() {\n    // Access sandbox\n    if (fsProvider.isFileSystemProvider) {\n        try {\n            const pluginFolder = await fsProvider.getEntryWithUrl(\"plugin-data:/\");\n            console.log(`File path: ${pluginFolder.nativePath}`);\n        } catch (e) {\n            console.error(e);\n        }\n    }\n}\n")),(0,i.mdx)("h4",{id:"manifest"},"manifest"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "requiredPermissions": {\n        "localFileSystem": "plugin"\n    }\n}\n')),(0,i.mdx)("h4",{id:"accessing-other-locations"},"Accessing other locations"),(0,i.mdx)(p,{slots:"heading, code",repeat:"2",languages:"JSON, JavaScript",mdxType:"CodeBlock"}),(0,i.mdx)("h4",{id:"javascript-1"},"JavaScript"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"const fsProvider = require('uxp').storage.localFileSystem;\nasync function foo() {\n    // Access other location\n    if (fsProvider.isFileSystemProvider) {\n        try {\n            const pluginFolder = await fsProvider.getEntryWithUrl(\"file:/Users/user/Documents\"); // update the path based on your system\n            console.log(`File path: ${pluginFolder.nativePath}`);\n        } catch (e) {\n            console.error(e);\n        }\n    }\n}\n")),(0,i.mdx)("h4",{id:"manifest-1"},"manifest"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "requiredPermissions": {\n        "localFileSystem": "fullAccess"\n    }\n}\n')),(0,i.mdx)("h4",{id:"users-choice-of-location"},"User's choice of location"),(0,i.mdx)("p",null,"These APIs are particularly handy when you want to request the user to select a folder/file location of their choice. For example, the below code snippet using ",(0,i.mdx)("inlineCode",{parentName:"p"},"getFileForOpening")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"getFileForSaving")," methods presents a file picker for the user to choose from."),(0,i.mdx)(p,{slots:"heading, code",repeat:"2",languages:"JSON, JavaScript",mdxType:"CodeBlock"}),(0,i.mdx)("h4",{id:"javascript-2"},"JavaScript"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},'const fsProvider = require(\'uxp\').storage.localFileSystem;\n\nasync function foo() {\n    // Ask user to select a file. Show their \'Desktop\' as the default folder.\n    if (fsProvider.isFileSystemProvider) {\n        const { domains, fileTypes } = require(\'uxp\').storage;\n\n        try {\n            const file = await fsProvider.getFileForOpening({ initialDomain: domains.userDesktop, types: fileTypes.text });\n            if (!file) {\n                console.error("Something went wrong.");\n                return;\n            }\n\n            // read the file content\n            const text = await file.read();\n            console.log(`File content: ${text}`);\n        } catch (err) {\n            console.error(err);\n        }\n    }\n}\n\nasync function bar() {\n    // Ask user to select a location to save a file\n    if (fsProvider.isFileSystemProvider) {\n        try {\n            const file = await fsProvider.getFileForSaving("sample.txt", { types: ["txt"] });\n            if (!file) {\n                console.error("Something went wrong.");\n                return;\n            }\n\n            // write content to file\n            await file.write("UXP saved sample file.");\n        } catch (err) {\n            console.error(err);\n        }        \n    }\n}\n')),(0,i.mdx)("h4",{id:"manifest-2"},"manifest"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "requiredPermissions": {\n        "localFileSystem": "request"\n    }\n}\n')),(0,i.mdx)("h4",{id:"save-users-choice-of-location"},"Save user's choice of location"),(0,i.mdx)("p",null,"If you would like to remember the user's choice for an extended period, you can do it with the help of a token. There are two types of tokens you can create"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Session token - has a shorter span. It lasts until the plugin is 'Unloaded' from UDT or the script finishes its execution or the application is closed. "),(0,i.mdx)("li",{parentName:"ul"},"Persistent token - is more permanent in nature, and can last for multiple sessions or until the plugin is 'Uninstalled'. (Since scripts only last for the time of their execution, you should not use persistent tokens in scripts.)")),(0,i.mdx)("p",null,"The example below shows the essence of this usage but you should ideally save these tokens in the storage (more details covered in ",(0,i.mdx)("a",{parentName:"p",href:"./storage.md"},"Storage")," section) for later use."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"const fsProvider = require('uxp').storage.localFileSystem;\n\nconst { domains, fileTypes } = require('uxp').storage;\nconst entry = await fsProvider.getFileForOpening({ initialDomain: domains.userDesktop, types: fileTypes.text });\nconst token = await fsProvider.createPersistentToken(entry); // store for future use\n\nasync function readFileUsingTokensInLocalFileSystem() {\n    // In the future, access the entry using the token directly\n    try {\n        const file = await fsProvider.getEntryForPersistentToken(token);\n        const text = await file.read();\n        console.log(`File content: ${text}`);\n    } catch (err) {\n        console.error(err);\n    }\n}\n")),(0,i.mdx)("h4",{id:"reference-material"},"Reference material"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Instance of ",(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Modules/uxp/Persistent%20File%20Storage/FileSystemProvider/"},"localFileSystem")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Modules/uxp/Persistent%20File%20Storage/Entry/"},"Entry")," and ",(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Modules/uxp/Persistent%20File%20Storage/EntryMetadata/"},"Entry metadata")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Modules/uxp/Persistent%20File%20Storage/File/"},"File")," and ",(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Modules/uxp/Persistent%20File%20Storage/Folder/"},"Folder")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Global%20Members/Path/"},"Path"))),(0,i.mdx)("h3",{id:"fs-module"},"FS Module"),(0,i.mdx)("p",null,"Based on NodeJS file system APIs, these provide direct access to file locations with the help of schema."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Accessing sandbox")),(0,i.mdx)(p,{slots:"heading, code",repeat:"2",languages:"JavaScript, JSON",mdxType:"CodeBlock"}),(0,i.mdx)("h4",{id:"javascript-3"},"JavaScript"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},'const fs = require("fs");\nasync function foo() {\n    // Read a file from sandbox using fs module\n    try {\n        const text = await fs.readFile("plugin:/sample.txt", \'utf8\');\n        console.log(`File content: ${text}`);\n    } catch (e) {\n        console.error(e);\n    }\n}\n')),(0,i.mdx)("h4",{id:"manifest-3"},"manifest"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "requiredPermissions": {\n        "localFileSystem": "plugin"\n    }\n}\n')),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Accessing other locations")),(0,i.mdx)(p,{slots:"heading, code",repeat:"2",languages:"JavaScript, JSON",mdxType:"CodeBlock"}),(0,i.mdx)("h4",{id:"javascript-4"},"JavaScript"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},'const fs = require("fs");\nasync function foo() {\n    // Write to a arbitrary location using fs module\n    try {\n        await fs.writeFile("/Users/user/Desktop/output.txt", "This is a sample text.", {encoding: "utf-8"}); // update the path based on your system\n    } catch (e) {\n        console.error(e);\n    }\n}\n')),(0,i.mdx)("h4",{id:"manifest-4"},"manifest"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "requiredPermissions": {\n        "localFileSystem": "fullAccess"\n    }\n}\n')),(0,i.mdx)("h4",{id:"reference-material-1"},"Reference material"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Modules/fs/"},"FS module")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"/uxp-indesign/indesign/uxp/reference/uxp-api/reference-js/Global%20Members/Path/"},"Path"))),(0,i.mdx)("h2",{id:"additional-notes"},"Additional Notes"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Despite the manifest setting ",(0,i.mdx)("inlineCode",{parentName:"li"},"fullAccess"),", certain files and folders may still not be accessible. It depends on the permission of the Operating System. For Win32 and Mac, these APIs can access anywhere in the file system. But, in UWP, accessing the system folder is prohibited.")))}x.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-resources-recipes-file-operation-index-md-c5edf8b7c52716b9ff78.js.map